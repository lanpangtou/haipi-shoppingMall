<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>结算页-嗨皮商城</title>
    <meta name="description" content="嗨皮，中国线上购物的地标网站，亚洲超大的综合性购物平台，拥有10万多品牌商家。每日发布大量国内外商品！正品网购，上嗨皮！嗨皮千万大牌正品,品类全，一站购，支付安全，退换无忧！理想生活上嗨皮!">
    <meta name="keywords" content="商城,网上购物,网购,进口食品,美容护理,母婴玩具,家用电器,手机数码,家居生活,服饰内衣,营养保健,钟表珠宝,饰品箱包,汽车生活,图书音像,礼品卡">
    <link rel="icon" href="image/icon.png"  type="image/x-icon">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link  rel="stylesheet" href="css/reset.css">
    <link  rel="stylesheet" href="css/commen.css">
    <link  rel="stylesheet" href="css/settleAccounts.css">
    <script src="js/jquery.js"></script>
</head>
<body>
<div id="settleApp">
    <!--    快捷导航栏-->
    <shortcut></shortcut>
<!--    结算区 start-->
    <div class="settle-container centre">
<!--        logo-->
        <div class="logo-con fl">
            <a href="index.html"></a>
            <span class="settle-title">结算页</span>
        </div>
<!--       进度条-->
        <div class="stepflex fr">
            <dl class="first-done fl">
                <dt class="s-num">1</dt>
                <dd class="s-text">1.我的购物车</dd>
                <i class="s-one"></i>
            </dl>
            <dl class="second-done fl">
                <dt class="s-num current">1</dt>
                <dd class="s-text">2.填写核对订单信息</dd>
                <i class="s-one"></i>
            </dl>
            <dl class="last-done fl">
                <dt class="s-num">1</dt>
                <dd class="s-text">3.成功提交订单</dd>
                <i class="s-one"></i>
            </dl>
        </div>
    </div>


    <div class="container">
        <div class="order-info centre">
            <div class="checkout-title">
                填写并核对订单信息
            </div>
            <div class="checkout-step">
                <div class="step-title">
                    <h3>收货人信息</h3>
                    <div class="extra">
                        <a href="#">新增收货地址</a>
                    </div>
                </div>
                <!--                收货人地址-->
                <div class="step-content">
                    <div class="consignee-address">
                        <ul>
                            <li>
                                <div class="consignee-item item-selected">
                                    <span>张三 四川</span>
                                    <b></b>
                                </div>
                                <div class="addre-detail">
                                    <span class="addre-name">张三</span>
                                    <span class="addre-info">四川 成都市 郫都区 红光镇 四川成都市郫***********某某大学</span>
                                    <span class="addre-tel">199****8255</span>
                                </div>
                            </li>
                            <li>
                                <div class="con-item consignee-item">
                                    <span>张三 四川</span>
                                </div>
                                <div class="addre-detail">
                                    <span class="addre-name">张三</span>
                                    <span class="addre-info">四川 成都市 郫都区 红光镇 四川成都市郫***********某某大学</span>
                                    <span class="addre-tel">199****8255</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="hr"></div>
<!--               支付方式 商品信息-->
                <div class="skuinfo">
                    <div class="step-title">
                        <h3>支付方式</h3>
                    </div>
                    <div class="step-content">
                        <div class="payment-list">
                            <ul>
                                <li>
                                    <div class="payment-item item-selected">
                                        <span>微信付款</span>
                                        <b></b>
                                    </div>
                                    <div class="payment-item">
                                        <span>支付宝付款</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="hr"></div>

                    <div class="step-title">
                        <h3>送货清单</h3>
                    </div>
                    <div class="delivery-list">
                        <div class="goods-item">
                            <div class="goods-item-extra"   v-for="(item,index) in goodsInfo" :key="index">
                               <div class="goods-item-img fl">
                                   <img :src="item.image" alt="">
                               </div>
                                <div class="goods-item-mesg fl">
                                   {{item.title}}
                                </div>
                                <div class="goods-item-price fr">
                                    <strong>{{item.price}}</strong>
                                    <strong>{{item.count}}</strong>
                                    <strong>有货</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hr"></div>

                    <div class="step-title">
                        <h3>发票信息</h3>
                    </div>
                    <div class="invoice-info">
                        普通发票（电子） 个人 明细
                    </div>
                </div>
            </div>

            <div class="statistic">
                <div class="total-price">
                    <span>{{totalNum}}</span> 件商品，总商品金额：￥<span>{{totalPrice}}</span>
                </div>
                <div class="freight">
                    运费：￥0.00
                </div>
            </div>

            <div class="trade">
                <div class="fc-price">
                    应付金额:　<span class="price">¥<span>{{totalPrice}}</span></span>
                </div>
                <div class="fc-receiverInfo">
                    寄送至： 四川 成都市 郫都区 红光镇 四川成都市郫***********某某大学 收货人：张三 199****8255
                </div>
            </div>
            <div class="submit">
                <a class="s-btn" @click="submit()">提交订单</a>
            </div>
        </div>
    </div>
</div>
    <!--    结算区 end-->

    <!--        footer start-->
    <div class="foot"></div>
    <script type="text/javascript">$(".foot").load("foot.html");</script>
    <!--        footer end-->
</body>
<script src="/js/vue.js"></script>
<script src="/js/axios.min.js"></script>
<script src="/js/commen.js"></script>
<script src="/js/qs.min.js"></script>
<script type="text/javascript">
    var vm = new Vue({
        el: "#settleApp",
        data: {
            goodsInfo: [],
            totalPrice: 0,
            totalNum: 0,
            addressId: 1,
            paymentId: 1,
            carts: [],
        },
        created() {
            this.getSelectItem();
        },
        methods: {
            getSelectItem() {
                this.goodsInfo = JSON.parse(localStorage.getItem("selectCarts"));
                for (let i = 0; i < this.goodsInfo.length; i++) {
                    this.totalNum += this.goodsInfo[i].count
                    this.totalPrice += this.goodsInfo[i].price * this.goodsInfo[i].count;
                }
                this.carts = this.goodsInfo.map(({skuId, count}) => ({skuId,count}));
            },
            submit() {
                Hp.http.post("/order/o/generate ",{
                    addressId: this.addressId,
                    paymentType: this.paymentId,
                    carts: this.carts,
                }).then(res => {
                    window.location = "http://www.haipi.com/cashier-order.html?id="+res.data;
                    localStorage.removeItem("selectCarts")
                }).catch(()=> {
                    alert("新增订单失败！");
                })
            }
        },
        components:{
            shortcut: () => import("./js/page/shortcut.js")
        }
    })
</script>
<script>
    window.onselectstart = ()=>{return false};
    $(function(){
        $(".consignee-item").click(function(){
            $(this).toggleClass("item-selected").siblings().removeClass("item-selected");
    });

    })
</script>
</html>
